## Revised Detailed Plan: Flutter Web Bursary Home (Student App)

**Goal:** Develop a responsive Flutter web application (`student_app`) within a `bursary_home` monorepo, leveraging Firebase for all backend services. It will use GoRouter for navigation, FlutterBloc for state management, and a dedicated `bursary_home_ui` package for shared UI components and theming.

---

### Phase 1: Monorepo & Core Infrastructure Setup (Days 1-4)

**Objective:** Establish the monorepo structure, initialize the Flutter app and shared UI package, integrate Firebase, and set up core dependencies.

1.  **Monorepo Root Creation:**
    *   Create the parent directory:
        ```bash
        mkdir C:\devs\django\bursary_home\flutter_apps
        cd C:\devs\django\bursary_home\flutter_apps
        mkdir bursary_home
        cd bursary_home
        ```
    *   This `bursary_home` directory will be the root of our Flutter monorepo.

2.  **Flutter Application (`student_app`) Initialization:**
    *   Create the Flutter web project inside the monorepo:
        ```bash
        flutter create student_app
        cd student_app
        flutter config --enable-web
        ```
    *   Verify Flutter setup: `flutter doctor`

3.  **Shared UI Package (`bursary_home_ui`) Initialization:**
    *   Navigate back to the monorepo root: `cd ..`
    *   Create the Flutter package:
        ```bash
        flutter create --template=package bursary_home_ui
        ```
    *   This package will contain shared widgets, themes, and fonts.

4.  **Firebase Project Setup & Integration (for `student_app`):**
    *   **Firebase Project:** Ensure you have an existing Firebase project.
    *   **Firebase CLI Login:** `firebase login`
    *   **FlutterFire CLI Installation:** `dart pub global activate flutterfire_cli`
    *   **Configure `student_app` with Firebase:**
        ```bash
        cd student_app
        flutterfire configure
        ```
        *   Select your Firebase project.
        *   Choose `web` as the target platform.
        *   This will generate `student_app/lib/firebase_options.dart`.
    *   **Initialize Firebase in `student_app/lib/main.dart`:**
        ```dart
        import 'package:firebase_core/firebase_core.dart';
        import 'package:flutter/material.dart';
        import 'firebase_options.dart'; // Generated by flutterfire configure

        void main() async {
          WidgetsFlutterBinding.ensureInitialized();
          await Firebase.initializeApp(
            options: DefaultFirebaseOptions.currentPlatform,
          );
          runApp(const MyApp());
        }
        // ... rest of your app
        ```

5.  **Add Core Dependencies (`student_app/pubspec.yaml`):**
    *   `firebase_auth`: For Google/Microsoft sign-in.
    *   `cloud_firestore`: For database operations (bursaries, profiles, applications).
    *   `firebase_storage`: For document uploads.
    *   `go_router`: For declarative routing.
    *   `flutter_bloc`: For state management.
    *   `equatable`: For simplifying Bloc state comparisons.
    *   `flutter_svg`: For SVG image support.
    *   `url_launcher`: For opening external links.
    *   `image_picker`: For selecting files from the web.
    *   `file_picker`: Alternative/complementary for file selection.
    *   `google_sign_in`: For Google Sign-In.
    *   **Local Package Dependency:** Add `bursary_home_ui` as a path dependency:
        ```yaml
        dependencies:
          flutter:
            sdk: flutter
          # ... other dependencies
          bursary_home_ui:
            path: ../bursary_home_ui # Relative path to the shared UI package
        ```
    *   Run `flutter pub get` in `student_app`.

6.  **Asset Management (within `student_app`):**
    *   Create `student_app/assets/images/` directory.
    *   Copy all relevant images from `C:/devs/django/bursary_home/static/images/` into `student_app/assets/images/`.
    *   Update `student_app/pubspec.yaml` to include assets:
        ```yaml
        flutter:
          uses-material-design: true
          assets:
            - assets/images/
        ```
    *   Run `flutter pub get` in `student_app`.

7.  **Shared UI Package Content (`bursary_home_ui/`):**
    *   **Theming (`bursary_home_ui/lib/theme/`):**
        *   `app_colors.dart`: Define `AppColors` class (static consts for primary, background, error, success, etc.). This will hold the base colors.
        *   `app_theme.dart`: Create `AppTheme` class with `ThemeData` (color scheme, text theme, button themes, input decoration themes). This will define the base theme.
        *   `app_fonts.dart`: Define font families and text styles.
    *   **Shared Widgets (`bursary_home_ui/lib/widgets/`):**
        *   **`LogoComponent`**: Displays the "Bursary Home" logo image and text title. (From `templates/components/logo_component.html`)
        *   **`AuthFormContainer`**: Generic container for login/registration forms, handling layout, shadows. (From `.auth-form`, `.base-form` in `static/base.css`)
        *   **`SocialLoginButton`**: Buttons for third-party authentication (e.g., Google, Microsoft). (From `.social-login-btn` in `static/base.css`)
        *   **`AlertMessage`**: Displays various types of alert messages (error, success, warning, info). (From `.alert`, `.alert-error`, etc. in `static/base.css`)
        *   **`FileUploadWidget`**: Custom widget for handling file uploads with label, icon, hint, and status. (From `.file-upload` in `static/base.css`)
        *   **`CustomInputField`**: Styled text input field, potentially with a leading icon. (From `.input-with-icon` in `static/base.css`)
        *   **`FormSectionHeader`**: Styled heading for sections within a form. (From `.form-section h3` in `static/base.css`)
        *   **`PrimaryButton`**: Styled button for primary actions. (From `.base-form button[type="submit"]`, `.submit-button` in `static/base.css`)
        *   **`DashboardHeaderSection`**: Prominent section with welcome message, date, status label, and illustrative image. (From `.header` in `static/base.css`)
        *   **`TopHeaderBar`**: Bar containing search input, notification icon, and user profile summary. (From `.top-header`, `.search-bar`, `.profile-section` in `static/base.css`)
        *   **`StatusLabel`**: Small, styled label to indicate verification status. (From `.status-label` in `static/base.css`)
        *   **`BursaryCard`**: Card widget to display individual bursary details. (From `.bursary-card` in `static/base.css`)
        *   **`ProgressBar`**: Visual indicator of progress. (From `.progress-bar` in `static/base.css`)
        *   **`CustomModal`**: Generic, customizable modal structure. (From `.modal-overlay`, `.modal` in `static/base.css` and `templates/components/modal_details.html`)
        *   **`SuccessDialog`**: Specific modal for displaying success messages. (From `.success-dialog-overlay`, `.success-dialog` in `static/base.css`)
        *   **`SidebarNavigationItem`**: Individual navigation items within the sidebar. (From `.sidebar-menu li` in `static/base.css`)
    *   **Export File (`bursary_home_ui/lib/bursary_home_ui.dart`):** Create a single export file for easy import into `student_app`.

8.  **Core Project Structure (within `student_app/lib/`):**
    *   `features/`:
        *   `auth/`:
            *   `bloc/`: `auth_bloc.dart`, `sign_in_bloc.dart`
            *   `views/`: `login_page.dart`
            *   `widgets/`: (feature-specific widgets if any, e.g., a custom Microsoft sign-in button if not handled by `bursary_home_ui`)
        *   `profile/`:
            *   `bloc/`: `profile_bloc.dart`, `document_upload_bloc.dart`
            *   `views/`: `complete_profile_page.dart`, `profile_page.dart`
            *   `widgets/`: (feature-specific widgets if any)
        *   `dashboard/`:
            *   `bloc/`: `dashboard_bloc.dart` (or `bursary_bloc.dart`)
            *   `views/`: `dashboard_page.dart`
            *   `widgets/`: (feature-specific widgets if any)
        *   `applications/`:
            *   `bloc/`: `applications_bloc.dart`
            *   `views/`: `applications_page.dart`
            *   `widgets/`: (feature-specific widgets if any)
    *   `data/`:
        *   `repositories/`: `auth_repository.dart`, `profile_repository.dart`, `bursary_repository.dart`, `application_repository.dart`
        *   `models/`: `user_model.dart`, `profile_model.dart`, `bursary_model.dart`, `application_model.dart`
    *   `core/`:
        *   `routes/`: `app_router.dart` (GoRouter configuration)
        *   `constants/`: `app_constants.dart`
        *   `utils/`: `app_utils.dart`

---

### Phase 2: Authentication & Routing (Days 5-8)

**Objective:** Implement the authentication flow with Google and Microsoft sign-in, and set up GoRouter for navigation with authentication guards.

1.  **Authentication Repository (`student_app/lib/data/repositories/auth_repository.dart`):**
    *   Abstract Firebase Auth calls (sign-in with Google, sign-in with Microsoft, sign-out).
    *   Handle `User` stream from Firebase Auth.

2.  **Authentication Blocs (`student_app/lib/features/auth/bloc/`):**
    *   **`AuthBloc`:** Manages the overall authentication state (authenticated, unauthenticated, unknown). Listens to `AuthRepository`'s user stream.
    *   **`SignInBloc`:** Handles sign-in events (GoogleSignInRequested, MicrosoftSignInRequested) and emits success/failure states.

3.  **Authentication Pages (`student_app/lib/features/auth/views/`):**
    *   **`LoginPage`:**
        *   UI: `LogoComponent`, welcome text, `SocialLoginButton` for Google and Microsoft.
        *   Integrate `SignInBloc` to trigger sign-in and listen for results.
        *   Use `AuthFormContainer` and `AlertMessage` from `bursary_home_ui`.
        *   **Microsoft Auth Integration:** At this step, I will request your specific reference/method for Microsoft authentication to integrate it with `SignInBloc`.

4.  **GoRouter Setup (`student_app/lib/core/routes/app_router.dart`):**
    *   Define all application routes (Login, Complete Profile, Dashboard, Applications, Profile).
    *   Implement `redirect` logic:
        *   If unauthenticated, redirect to `LoginPage`.
        *   If authenticated but profile incomplete, redirect to `CompleteProfilePage`.
        *   If authenticated and profile complete, redirect to `DashboardPage`.
    *   Integrate `AuthBloc` to determine authentication status for redirects.

---

### Phase 3: Profile Management (Days 9-13)

**Objective:** Implement the initial profile completion flow, including single document upload and simulated AI processing.

1.  **Profile Data Model (`student_app/lib/data/models/profile_model.dart`):
    *   Define `StudentProfile` class (e.g., `id`, `userId`, `status`, `matricResultsDocUrl`, `extractedData`).

2.  **Profile Repository (`student_app/lib/data/repositories/profile_repository.dart`):**
    *   Firestore operations: Fetch, create, update `StudentProfile` documents.
    *   Firebase Storage operations: Upload matric results document, get download URL.

3.  **Profile Blocs (`student_app/lib/features/profile/bloc/`):**
    *   **`ProfileBloc`:** Manages `StudentProfile` state (loading, loaded, error). Handles events like `LoadProfile`, `UpdateProfile`.
    *   **`DocumentUploadBloc`:** Manages the state of a single document upload (initial, uploading, success, failure). Handles `UploadDocument` event.
        *   Simulate AI processing with `Future.delayed` after successful upload.

4.  **Profile Pages (`student_app/lib/features/profile/views/`):**
    *   **`CompleteProfilePage`:**
        *   UI: Form for basic profile details, `FileUploadWidget` (from `bursary_home_ui`) for matric results.
        *   Integrate `ProfileBloc` for profile data and `DocumentUploadBloc` for upload.
        *   Trigger `ProfileBloc` update after successful document upload and simulated AI processing.
        *   Uses `FormSectionHeader`, `CustomInputField`, `PrimaryButton` from `bursary_home_ui`.
    *   **`ProfilePage`:** (For viewing/editing, initially simple)
        *   UI: Display current profile details.
        *   Integrate `ProfileBloc`.

---

### Phase 4: Dashboard & Bursary Listing (Days 14-18)

**Objective:** Implement the main dashboard view, displaying bursaries and user status.

1.  **Bursary Data Model (`student_app/lib/data/models/bursary_model.dart`):**
    *   Define `Bursary` class (e.g., `id`, `name`, `provider`, `deadline`, `fieldOfStudy`, `gpaRequirement`).

2.  **Bursary Repository (`student_app/lib/data/repositories/bursary_repository.dart`):**
    *   Firestore operations: Fetch list of bursaries, fetch single bursary.

3.  **Bursary Blocs (`student_app/lib/features/dashboard/bloc/` or `student_app/lib/features/bursary/bloc/`):**
    *   **`BursaryBloc`:** Manages the list of available bursaries (loading, loaded, error). Handles `LoadBursaries` event.

4.  **Dashboard Pages (`student_app/lib/features/dashboard/views/`):**
    *   **`DashboardPage`:**
        *   UI: `DashboardHeaderSection` (from `bursary_home_ui`, welcome, date, `StatusLabel`), list of `BursaryCard` widgets (from `bursary_home_ui`).
        *   Integrate `ProfileBloc` (for user status) and `BursaryBloc` (for bursary list).
        *   Uses `TopHeaderBar`, `SidebarNavigationItem` from `bursary_home_ui` for overall layout.
    *   **`BursaryDetailsPage`:** (Displayed as a modal using `CustomModal` from `bursary_home_ui`)
        *   UI: Detailed view of a single bursary.

---

### Phase 5: Applications & Refinement (Days 19-22)

**Objective:** Implement the applications listing, and perform overall testing and polish.

1.  **Application Data Model (`student_app/lib/data/models/application_model.dart`):**
    *   Define `Application` class (e.g., `id`, `bursaryId`, `userId`, `status`, `progress`).

2.  **Application Repository (`student_app/lib/data/repositories/application_repository.dart`):**
    *   Firestore operations: Fetch user's applications, create new application, update application status.

3.  **Application Blocs (`student_app/lib/features/applications/bloc/`):**
    *   **`ApplicationsBloc`:** Manages the list of user's applications. Handles `LoadApplications`, `SubmitApplication`, `CancelApplication` events.

4.  **Application Pages (`student_app/lib/features/applications/views/`):**
    *   **`ApplicationsPage`:**
        *   UI: List of `BursaryCard` widgets (reused for applications, showing status/progress).
        *   Integrate `ApplicationsBloc`.

5.  **Overall UI Integration & Polish:**
    *   Ensure all pages are integrated with GoRouter.
    *   Verify responsive design across different web breakpoints.
    *   Refine styling using `bursary_home_ui` components, ensuring consistent look and feel.
    *   Implement loading indicators and error messages for all data operations.

6.  **Testing (within `student_app`):**
    *   **Unit Tests:** For all Blocs and Repositories.
    *   **Widget Tests:** For key `bursary_home_ui` widgets and feature-specific UI components.
    *   **Integration Tests:** For critical user flows (e.g., sign-in, profile completion, viewing dashboard).

---

### Phase 6: Deployment & Final Review (Days 23-24)

**Objective:** Prepare the application for deployment and conduct a final review.

1.  **Web Build (from `student_app` directory):**
    ```bash
    flutter build web --release
    ```
2.  **Firebase Hosting:**
    *   Initialize Firebase Hosting: `firebase init hosting` (if not already done, from `student_app` directory).
    *   Deploy the web app: `firebase deploy --only hosting`
3.  **Final Review:**
    *   Cross-browser compatibility check.
    *   Performance optimization.
    *   Accessibility review.
